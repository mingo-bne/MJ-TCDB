<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MJ Card Tracker - Smart Collection Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        .autocomplete-dropdown {
            position: absolute;
            background: #1f2937;
            border: 1px solid #374151;
            border-radius: 0.5rem;
            max-height: 300px;
            overflow-y: auto;
            z-index: 50;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
        }
        .autocomplete-item {
            padding: 0.75rem;
            cursor: pointer;
            border-bottom: 1px solid #374151;
            min-height: 60px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .autocomplete-item:hover, .autocomplete-item:active {
            background: #374151;
        }
        .scrollable-table {
            max-height: calc(100vh - 400px);
            overflow-y: auto;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        .sticky-header th {
            position: sticky;
            top: 0;
            background: #1f2937;
            z-index: 10;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        /* Mobile-friendly table */
        @media (max-width: 768px) {
            .scrollable-table {
                max-height: calc(100vh - 500px);
            }
            table {
                font-size: 0.875rem;
            }
            input, select, textarea {
                font-size: 16px !important; /* Prevents zoom on iOS */
            }
            .autocomplete-dropdown {
                max-height: 250px;
            }
        }
        /* Touch-friendly buttons */
        button, .autocomplete-item {
            min-height: 44px; /* iOS recommended touch target */
        }
        /* Better scrollbars on mobile */
        .scrollable-table::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        .scrollable-table::-webkit-scrollbar-track {
            background: #1f2937;
        }
        .scrollable-table::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 4px;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        function App() {
            // My collection state (what I actually own)
            const [myCollection, setMyCollection] = useState([]);
            
            // Reference database (loaded lazily for validation/search)
            const [referenceDB, setReferenceDB] = useState(null);
            const [dbLoading, setDbLoading] = useState(false);
            
            // Add card form state
            const [searchInput, setSearchInput] = useState('');
            const [suggestions, setSuggestions] = useState([]);
            const [showSuggestions, setShowSuggestions] = useState(false);
            const [selectedCard, setSelectedCard] = useState(null);
            const [quantity, setQuantity] = useState(1);
            const [purchasePrice, setPurchasePrice] = useState('');
            const [notes, setNotes] = useState('');
            const [grade, setGrade] = useState('');
            
            // Filter state
            const [filterText, setFilterText] = useState('');
            const [sortField, setSortField] = useState('dateAdded');
            const [sortDirection, setSortDirection] = useState('desc');
            
            // UI state
            const [editingCard, setEditingCard] = useState(null);
            const [showAddModal, setShowAddModal] = useState(false);
            const [mobileView, setMobileView] = useState(false);
            const [saveStatus, setSaveStatus] = useState(''); // 'saving', 'saved', 'error'
            const [showImageModal, setShowImageModal] = useState(false);
            const [imageSearchResults, setImageSearchResults] = useState([]);
            const [selectedImageUrl, setSelectedImageUrl] = useState('');
            const [currentImageCard, setCurrentImageCard] = useState(null);
            const [showCardDetailModal, setShowCardDetailModal] = useState(false);
            const [detailCard, setDetailCard] = useState(null);
            const [showAddPriceModal, setShowAddPriceModal] = useState(false);
            const [priceCard, setPriceCard] = useState(null);
            const [newPrice, setNewPrice] = useState('');
            const [priceGradeCompany, setPriceGradeCompany] = useState('');
            const [priceGradeValue, setPriceGradeValue] = useState('');
            const [priceNotes, setPriceNotes] = useState('');
            
            // Collection group management
            const [collections, setCollections] = useState({});
            const [currentCollection, setCurrentCollection] = useState('main');
            const [showCollectionManager, setShowCollectionManager] = useState(false);
            const [newCollectionName, setNewCollectionName] = useState('');
            
            const searchInputRef = useRef(null);

            // Theme configurations
            // Clean theme (only theme)
            const t = {
                name: 'Clean',
                header: 'bg-gradient-to-r from-slate-700 to-slate-800',
                headerText: 'text-white',
                headerSubtext: 'text-slate-200',
                stat: 'bg-white bg-opacity-10 backdrop-blur',
                statText: 'text-white',
                statLabel: 'text-slate-200',
                bg: 'bg-slate-900',
                card: 'bg-slate-800',
                cardBorder: 'border-slate-700',
                button: 'bg-slate-600 hover:bg-slate-700',
                buttonPrimary: 'bg-blue-600 hover:bg-blue-700',
                buttonSuccess: 'bg-emerald-600 hover:bg-emerald-700',
                buttonDanger: 'bg-rose-600 hover:bg-rose-700',
                buttonPurple: 'bg-purple-600 hover:bg-purple-700',
                input: 'bg-slate-700 border-slate-600 text-white',
                text: 'text-slate-100',
                textMuted: 'text-slate-400'
            };

            // Load collections on mount
            useEffect(() => {
                const stored = localStorage.getItem('mj-collections');
                if (stored) {
                    try {
                        const loadedCollections = JSON.parse(stored);
                        setCollections(loadedCollections);
                    } catch (error) {
                        console.log('Error loading collections');
                    }
                } else {
                    // Initialize with default collections
                    const defaultCollections = {
                        main: { name: 'Main Collection', cards: [] },
                        'for-sale': { name: 'For Sale', cards: [] },
                        'for-trade': { name: 'For Trade', cards: [] }
                    };
                    setCollections(defaultCollections);
                    localStorage.setItem('mj-collections', JSON.stringify(defaultCollections));
                }
                
                // Load current collection preference
                const savedCurrent = localStorage.getItem('mj-current-collection');
                if (savedCurrent) {
                    setCurrentCollection(savedCurrent);
                }
            }, []);

            // Save collections whenever they change
            useEffect(() => {
                if (Object.keys(collections).length > 0) {
                    localStorage.setItem('mj-collections', JSON.stringify(collections));
                }
            }, [collections]);

            // Update myCollection to reflect current collection's cards
            useEffect(() => {
                if (collections[currentCollection]) {
                    setMyCollection(collections[currentCollection].cards || []);
                }
            }, [currentCollection, collections]);

            // Override saveMyCollection to save to current collection
            const saveToCurrentCollection = (cards) => {
                setCollections(prev => ({
                    ...prev,
                    [currentCollection]: {
                        ...prev[currentCollection],
                        cards: cards
                    }
                }));
                setMyCollection(cards);
            };

            // Collection management functions
            const switchCollection = (collectionId) => {
                setCurrentCollection(collectionId);
                localStorage.setItem('mj-current-collection', collectionId);
            };

            const createCollection = () => {
                if (!newCollectionName.trim()) {
                    alert('Please enter a collection name');
                    return;
                }
                
                const id = newCollectionName.toLowerCase().replace(/\s+/g, '-');
                
                if (collections[id]) {
                    alert('A collection with this name already exists');
                    return;
                }
                
                setCollections(prev => ({
                    ...prev,
                    [id]: { name: newCollectionName, cards: [] }
                }));
                
                setNewCollectionName('');
                setShowCollectionManager(false);
            };

            const deleteCollection = (collectionId) => {
                if (collectionId === 'main') {
                    alert('Cannot delete Main Collection');
                    return;
                }
                
                if (!confirm(`Delete "${collections[collectionId]?.name}"? This cannot be undone!`)) {
                    return;
                }
                
                const newCollections = { ...collections };
                delete newCollections[collectionId];
                setCollections(newCollections);
                
                if (currentCollection === collectionId) {
                    switchCollection('main');
                }
            };

            const renameCollection = (collectionId, newName) => {
                if (!newName.trim()) return;
                
                setCollections(prev => ({
                    ...prev,
                    [collectionId]: {
                        ...prev[collectionId],
                        name: newName
                    }
                }));
            };

            const moveCardToCollection = (card, targetCollectionId) => {
                // Remove from current collection
                const updatedCurrentCards = myCollection.filter(c => c.id !== card.id);
                saveToCurrentCollection(updatedCurrentCards);
                
                // Add to target collection
                setCollections(prev => ({
                    ...prev,
                    [targetCollectionId]: {
                        ...prev[targetCollectionId],
                        cards: [...(prev[targetCollectionId].cards || []), card]
                    }
                }));
            };

            // Detect mobile on mount
            useEffect(() => {
                const checkMobile = () => {
                    setMobileView(window.innerWidth < 768);
                };
                checkMobile();
                window.addEventListener('resize', checkMobile);
                return () => window.removeEventListener('resize', checkMobile);
            }, []);

            // Collections are loaded by useEffect above

            const saveMyCollection = (newCollection) => {
                try {
                    setSaveStatus('saving');
                    saveToCurrentCollection(newCollection);
                    setSaveStatus('saved');
                    setTimeout(() => setSaveStatus(''), 2000);
                } catch (error) {
                    console.error('Failed to save collection:', error);
                    setSaveStatus('error');
                    alert('Failed to save. Please export as backup.');
                }
            };

            const loadReferenceDB = async () => {
                if (referenceDB) return; // Already loaded
                
                setDbLoading(true);
                try {
                    // Try to load from external file
                    const response = await fetch('./jordan_cards_database.json');
                    if (response.ok) {
                        const data = await response.json();
                        setReferenceDB(data);
                        console.log(`‚úì Loaded ${data.length} reference cards from database file`);
                        alert(`‚úì Database loaded successfully!\n\n${data.length.toLocaleString()} Michael Jordan cards are now searchable.`);
                    } else {
                        throw new Error(`HTTP ${response.status}`);
                    }
                } catch (error) {
                    console.error('Failed to load external database:', error);
                    
                    // Check if it's a CORS error (opening HTML file directly)
                    if (error.message.includes('fetch') || error instanceof TypeError) {
                        alert('‚ö†Ô∏è Cannot load database file\n\nYou need to use a web server to load the full database.\n\nOptions:\n1. Use: python -m http.server 8000\n2. Or use the sample data (12 cards) for testing\n\nClick OK to use sample data for now.');
                        setReferenceDB(generateSampleReferenceDB());
                    } else {
                        alert('Error loading database. Using sample data (12 cards).');
                        setReferenceDB(generateSampleReferenceDB());
                    }
                }
                setDbLoading(false);
            };

            const generateSampleReferenceDB = () => {
                return [
                    { description: '1986-87 Fleer 57 Michael Jordan RC', year: '1986', brand: 'Fleer', cardNumber: '57', serialNumber: '' },
                    { description: '1986-87 Fleer Sticker 8 Michael Jordan', year: '1986', brand: 'Fleer', cardNumber: '8', serialNumber: '' },
                    { description: '1984-85 Star 101 Michael Jordan RC', year: '1984', brand: 'Star', cardNumber: '101', serialNumber: '' },
                    { description: '1997-98 Metal Universe Precious Metal Gems 23 Michael Jordan', year: '1997', brand: 'Metal Universe', cardNumber: '23', serialNumber: '/10' },
                    { description: '1997-98 Upper Deck Game Jersey Michael Jordan', year: '1997', brand: 'Upper Deck', cardNumber: 'GJ13', serialNumber: '' },
                    { description: '2003-04 Upper Deck Exquisite Collection 23 Michael Jordan', year: '2003', brand: 'Exquisite', cardNumber: '23', serialNumber: '/23' },
                    { description: '1996-97 Topps Chrome 139 Michael Jordan', year: '1996', brand: 'Topps Chrome', cardNumber: '139', serialNumber: '' },
                    { description: '1998-99 SPx Finite 100 Michael Jordan', year: '1998', brand: 'SPx', cardNumber: '100', serialNumber: '/5000' },
                    { description: '1989-90 Hoops 200 Michael Jordan', year: '1989', brand: 'Hoops', cardNumber: '200', serialNumber: '' },
                    { description: '1990-91 Fleer 26 Michael Jordan', year: '1990', brand: 'Fleer', cardNumber: '26', serialNumber: '' },
                    { description: '1995-96 Finest 229 Michael Jordan Refractor', year: '1995', brand: 'Finest', cardNumber: '229', serialNumber: '' },
                    { description: '1997-98 Skybox Premium Star Rubies 23 Michael Jordan', year: '1997', brand: 'Skybox', cardNumber: '23', serialNumber: '' },
                ];
            };

            // Search and suggest cards from reference DB
            const handleSearchInput = async (value) => {
                setSearchInput(value);
                
                if (value.length < 2) {
                    setSuggestions([]);
                    setShowSuggestions(false);
                    return;
                }

                // Load reference DB if not loaded
                if (!referenceDB) {
                    await loadReferenceDB();
                }

                if (referenceDB) {
                    const searchLower = value.toLowerCase();
                    const searchTerms = searchLower.split(' ').filter(t => t.length > 0);
                    
                    const matches = referenceDB.filter(card => {
                        const desc = card.description.toLowerCase();
                        const year = String(card.year).toLowerCase();
                        const brand = String(card.brand).toLowerCase();
                        const cardNum = String(card.cardNumber).toLowerCase();
                        const combined = `${desc} ${year} ${brand} ${cardNum}`;
                        
                        // Match if ALL search terms are found anywhere in the card data
                        return searchTerms.every(term => combined.includes(term));
                    }).slice(0, 20); // Increased to 20 suggestions
                    
                    setSuggestions(matches);
                    setShowSuggestions(matches.length > 0);
                }
            };

            const selectSuggestion = (card) => {
                setSelectedCard(card);
                setSearchInput(card.description);
                setShowSuggestions(false);
                setSuggestions([]);
            };

            const addCardToCollection = () => {
                if (!searchInput.trim()) {
                    alert('Please enter a card description');
                    return;
                }

                // Create base card with first variant
                const newCard = {
                    id: Date.now().toString(),
                    description: selectedCard ? selectedCard.description : searchInput,
                    year: selectedCard?.year || '',
                    brand: selectedCard?.brand || '',
                    series: selectedCard?.series || '',
                    cardNumber: selectedCard?.cardNumber || '',
                    imageUrl: selectedImageUrl || '',
                    dateAdded: new Date().toISOString(),
                    validated: !!selectedCard,
                    variants: [{
                        id: `${Date.now()}-1`,
                        gradeCompany: grade ? (grade.match(/PSA|BGS|SGC|CGC/i)?.[0] || '') : '',
                        gradeValue: grade || 'Raw',
                        quantity: parseInt(quantity) || 1,
                        purchasePrice: purchasePrice || '',
                        purchaseDate: new Date().toISOString(),
                        notes: notes || '',
                        isRaw: !grade || !grade.match(/PSA|BGS|SGC|CGC/i)
                    }],
                    priceHistory: []
                };

                const updated = [...myCollection, newCard];
                saveMyCollection(updated);
                
                resetForm();
                setShowAddModal(false);
            };

            const resetForm = () => {
                setSearchInput('');
                setSelectedCard(null);
                setQuantity(1);
                setPurchasePrice('');
                setGrade('');
                setNotes('');
                setSelectedImageUrl('');
                setSuggestions([]);
                setShowSuggestions(false);
            };

            const updateCard = (id, updates) => {
                const updated = myCollection.map(card => 
                    card.id === id ? { ...card, ...updates } : card
                );
                saveMyCollection(updated);
            };

            const deleteCard = (id) => {
                if (confirm('Are you sure you want to remove this card from your collection?')) {
                    const updated = myCollection.filter(card => card.id !== id);
                    saveMyCollection(updated);
                }
            };

            const filteredCollection = useMemo(() => {
                let filtered = myCollection.filter(card =>
                    !filterText || 
                    card.description.toLowerCase().includes(filterText.toLowerCase()) ||
                    card.year.toLowerCase().includes(filterText.toLowerCase()) ||
                    card.brand.toLowerCase().includes(filterText.toLowerCase())
                );

                filtered.sort((a, b) => {
                    let aVal = a[sortField] || '';
                    let bVal = b[sortField] || '';
                    
                    if (sortField === 'quantity' || sortField === 'purchasePrice') {
                        aVal = parseFloat(aVal) || 0;
                        bVal = parseFloat(bVal) || 0;
                    }
                    
                    if (sortDirection === 'asc') {
                        return aVal > bVal ? 1 : -1;
                    } else {
                        return aVal < bVal ? 1 : -1;
                    }
                });

                return filtered;
            }, [myCollection, filterText, sortField, sortDirection]);

            const stats = useMemo(() => {
                const totalCards = myCollection.reduce((sum, card) => {
                    const variantTotal = (card.variants || []).reduce((vSum, v) => vSum + (v.quantity || 0), 0);
                    return sum + variantTotal;
                }, 0);
                
                const totalCost = myCollection.reduce((sum, card) => {
                    const variantValue = (card.variants || []).reduce((vSum, v) => {
                        const price = parseFloat(v.purchasePrice) || 0;
                        return vSum + (price * (v.quantity || 0));
                    }, 0);
                    return sum + variantValue;
                }, 0);
                
                // Current value (market value from price history or purchase cost)
                const currentValue = myCollection.reduce((sum, card) => {
                    let cardValue = 0;
                    (card.variants || []).forEach(variant => {
                        const qty = variant.quantity || 0;
                        const gradeKey = variant.gradeCompany && variant.gradeCompany !== 'Raw'
                            ? `${variant.gradeCompany} ${variant.gradeValue}`
                            : 'Raw';
                        
                        // Find matching price history entry
                        const matchingPrices = (card.priceHistory || []).filter(p => {
                            const priceGrade = p.gradeCompany && p.gradeCompany !== 'Raw'
                                ? `${p.gradeCompany} ${p.gradeValue}`
                                : 'Raw';
                            return priceGrade === gradeKey;
                        });
                        
                        if (matchingPrices.length > 0) {
                            // Use latest price entry
                            const latestPrice = matchingPrices.sort((a, b) => 
                                new Date(b.date) - new Date(a.date)
                            )[0];
                            cardValue += (latestPrice.price || 0) * qty;
                        } else if (variant.purchasePrice) {
                            // Use purchase cost
                            cardValue += (parseFloat(variant.purchasePrice) || 0) * qty;
                        }
                    });
                    return sum + cardValue;
                }, 0);
                
                const validatedCards = myCollection.filter(card => card.validated).length;
                
                return {
                    uniqueCards: myCollection.length,
                    totalCards,
                    totalCost: totalCost.toFixed(2),
                    currentValue: currentValue.toFixed(2),
                    validatedCards
                };
            }, [myCollection]);

            const searchCardImage = (card) => {
                const query = `${card.year} ${card.brand} ${card.cardNumber} Michael Jordan card`.trim();
                window.open(`https://www.google.com/search?tbm=isch&q=${encodeURIComponent(query)}`, '_blank');
            };

            const findAndSaveImage = async (card) => {
                setCurrentImageCard(card);
                setSelectedImageUrl(card.imageUrl || '');
                setShowImageModal(true);
            };

            const saveCardImage = (imageUrl) => {
                if (!imageUrl || !imageUrl.trim()) {
                    alert('Please enter a valid image URL');
                    return;
                }
                
                if (currentImageCard) {
                    updateCard(currentImageCard.id, { imageUrl: imageUrl.trim() });
                    setShowImageModal(false);
                    setCurrentImageCard(null);
                    setSelectedImageUrl('');
                }
            };

            const removeCardImage = () => {
                if (currentImageCard) {
                    updateCard(currentImageCard.id, { imageUrl: '' });
                    setShowImageModal(false);
                    setCurrentImageCard(null);
                    setSelectedImageUrl('');
                }
            };

            const openCardDetail = (card) => {
                setDetailCard(card);
                setShowCardDetailModal(true);
            };

            const openAddPrice = (card) => {
                setPriceCard(card);
                setNewPrice('');
                setPriceGradeCompany('');
                setPriceGradeValue('');
                setPriceNotes('');
                setShowAddPriceModal(true);
            };

            const addPriceRecord = () => {
                if (!newPrice || !newPrice.trim()) {
                    alert('Please enter a price');
                    return;
                }

                const priceEntry = {
                    id: Date.now().toString(),
                    price: parseFloat(newPrice.replace(/[^0-9.]/g, '')) || 0,
                    gradeCompany: priceGradeCompany || 'Raw',
                    gradeValue: priceGradeValue || '',
                    notes: priceNotes || '',
                    date: new Date().toISOString(),
                    dateFormatted: new Date().toLocaleDateString()
                };

                const updatedCard = {
                    ...priceCard,
                    priceHistory: [...(priceCard.priceHistory || []), priceEntry],
                    lastPriceCheck: new Date().toISOString()
                };

                updateCard(priceCard.id, {
                    priceHistory: updatedCard.priceHistory,
                    lastPriceCheck: updatedCard.lastPriceCheck
                });

                setShowAddPriceModal(false);
                setPriceCard(null);
            };

            const deletePriceRecord = (cardId, priceId) => {
                const card = myCollection.find(c => c.id === cardId);
                if (!card) return;

                const updatedHistory = (card.priceHistory || []).filter(p => p.id !== priceId);
                updateCard(cardId, { priceHistory: updatedHistory });
            };

            // Variant management (different grades/conditions of same card)
            const [showAddVariantModal, setShowAddVariantModal] = useState(false);
            const [variantCard, setVariantCard] = useState(null);
            const [variantGradeCompany, setVariantGradeCompany] = useState('');
            const [variantGradeValue, setVariantGradeValue] = useState('');
            const [variantQuantity, setVariantQuantity] = useState(1);
            const [variantPurchasePrice, setVariantPurchasePrice] = useState('');
            const [variantNotes, setVariantNotes] = useState('');

            const openAddVariant = (card) => {
                setVariantCard(card);
                setVariantGradeCompany('');
                setVariantGradeValue('');
                setVariantQuantity(1);
                setVariantPurchasePrice('');
                setVariantNotes('');
                setShowAddVariantModal(true);
            };

            const addVariant = () => {
                if (!variantCard) return;

                const newVariant = {
                    id: Date.now().toString(),
                    gradeCompany: variantGradeCompany || '',
                    gradeValue: variantGradeValue || 'Raw',
                    quantity: parseInt(variantQuantity) || 1,
                    purchasePrice: variantPurchasePrice || '',
                    purchaseDate: new Date().toISOString(),
                    notes: variantNotes || '',
                    isRaw: !variantGradeCompany || variantGradeCompany === 'Raw'
                };

                const updatedVariants = [...(variantCard.variants || []), newVariant];
                updateCard(variantCard.id, { variants: updatedVariants });
                
                setShowAddVariantModal(false);
                setVariantCard(null);
            };

            const deleteVariant = (cardId, variantId) => {
                const card = myCollection.find(c => c.id === cardId);
                if (!card || !card.variants) return;

                if (card.variants.length <= 1) {
                    alert('Cannot delete the last variant. Delete the entire card instead.');
                    return;
                }

                if (!confirm('Delete this card variant?')) return;

                const updatedVariants = card.variants.filter(v => v.id !== variantId);
                updateCard(cardId, { variants: updatedVariants });
            };

            const updateVariant = (cardId, variantId, updates) => {
                const card = myCollection.find(c => c.id === cardId);
                if (!card || !card.variants) return;

                const updatedVariants = card.variants.map(v => 
                    v.id === variantId ? { ...v, ...updates } : v
                );
                updateCard(cardId, { variants: updatedVariants });
            };

            // Export functions
            const exportToCSV = () => {
                // Create CSV with one row per variant
                let csv = 'Card,Year,Brand,Card Number,Grade Company,Grade,Quantity,Purchase Price,Purchase Date,Notes,Validated\n';
                
                myCollection.forEach(card => {
                    (card.variants || []).forEach(variant => {
                        const row = [
                            `"${card.description}"`,
                            card.year || '',
                            card.brand || '',
                            card.cardNumber || '',
                            variant.gradeCompany || 'Raw',
                            variant.gradeValue || '',
                            variant.quantity || 0,
                            variant.purchasePrice || '',
                            variant.purchaseDate ? new Date(variant.purchaseDate).toLocaleDateString() : '',
                            `"${(variant.notes || '').replace(/"/g, '""')}"`,
                            card.validated ? 'Yes' : 'No'
                        ].join(',');
                        csv += row + '\n';
                    });
                });

                const blob = new Blob([csv], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `mj-collection-${new Date().toISOString().split('T')[0]}.csv`;
                a.click();
                URL.revokeObjectURL(url);
            };

            const exportToXLSX = async () => {
                try {
                    // Load SheetJS from CDN
                    if (!window.XLSX) {
                        const script = document.createElement('script');
                        script.src = 'https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js';
                        document.head.appendChild(script);
                        await new Promise((resolve) => { script.onload = resolve; });
                    }

                    // Create workbook with two sheets: Summary and Details
                    const wb = window.XLSX.utils.book_new();

                    // Summary sheet (one row per card with totals)
                    const summaryData = myCollection.map(card => {
                        const totalQty = (card.variants || []).reduce((sum, v) => sum + (v.quantity || 0), 0);
                        const totalCost = (card.variants || []).reduce((sum, v) => {
                            const price = parseFloat(v.purchasePrice) || 0;
                            return sum + (price * (v.quantity || 0));
                        }, 0);
                        
                        return {
                            'Card': card.description,
                            'Year': card.year,
                            'Brand': card.brand,
                            'Card #': card.cardNumber,
                            'Variants': (card.variants || []).length,
                            'Total Qty': totalQty,
                            'Total Cost': totalCost,
                            'Validated': card.validated ? 'Yes' : 'No'
                        };
                    });
                    const wsSummary = window.XLSX.utils.json_to_sheet(summaryData);
                    window.XLSX.utils.book_append_sheet(wb, wsSummary, 'Summary');

                    // Details sheet (one row per variant)
                    const detailsData = [];
                    myCollection.forEach(card => {
                        (card.variants || []).forEach(variant => {
                            detailsData.push({
                                'Card': card.description,
                                'Year': card.year,
                                'Brand': card.brand,
                                'Card #': card.cardNumber,
                                'Grade Company': variant.gradeCompany || 'Raw',
                                'Grade': variant.gradeValue || '',
                                'Quantity': variant.quantity || 0,
                                'Purchase Price': variant.purchasePrice || '',
                                'Purchase Date': variant.purchaseDate ? new Date(variant.purchaseDate).toLocaleDateString() : '',
                                'Notes': variant.notes || '',
                                'Validated': card.validated ? 'Yes' : 'No'
                            });
                        });
                    });
                    const wsDetails = window.XLSX.utils.json_to_sheet(detailsData);
                    window.XLSX.utils.book_append_sheet(wb, wsDetails, 'Details');

                    // Download
                    window.XLSX.writeFile(wb, `mj-collection-${new Date().toISOString().split('T')[0]}.xlsx`);
                } catch (error) {
                    console.error('Export error:', error);
                    alert('Error creating Excel file. Please try CSV export instead.');
                }
            };

            const exportToGoogleSheets = () => {
                // Create CSV content
                let csv = 'Card,Year,Brand,Card Number,Grade Company,Grade,Quantity,Purchase Price,Purchase Date,Notes,Validated\n';
                
                myCollection.forEach(card => {
                    (card.variants || []).forEach(variant => {
                        const row = [
                            `"${card.description}"`,
                            card.year || '',
                            card.brand || '',
                            card.cardNumber || '',
                            variant.gradeCompany || 'Raw',
                            variant.gradeValue || '',
                            variant.quantity || 0,
                            variant.purchasePrice || '',
                            variant.purchaseDate ? new Date(variant.purchaseDate).toLocaleDateString() : '',
                            `"${(variant.notes || '').replace(/"/g, '""')}"`,
                            card.validated ? 'Yes' : 'No'
                        ].join(',');
                        csv += row + '\n';
                    });
                });

                // Copy to clipboard
                navigator.clipboard.writeText(csv).then(() => {
                    alert('‚úÖ CSV data copied to clipboard!\n\nNext steps:\n1. Go to Google Sheets (sheets.google.com)\n2. Create a new spreadsheet\n3. Click cell A1\n4. Press Ctrl+V (or Cmd+V) to paste\n5. Data will populate automatically!');
                    
                    // Also download as CSV backup
                    const blob = new Blob([csv], { type: 'text/csv' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `mj-collection-${new Date().toISOString().split('T')[0]}.csv`;
                    a.click();
                    URL.revokeObjectURL(url);
                }).catch(() => {
                    alert('Could not copy to clipboard. CSV file will download instead.');
                    exportToCSV();
                });
            };

            const checkPrice = (card) => {
                // Simply open 130point.com main search page
                window.open('https://130point.com/sales/', '_blank');
                
                // Copy card description to clipboard for easy pasting
                const cardText = `${card.year} ${card.brand} ${card.cardNumber} Michael Jordan`.trim();
                
                // Try to copy to clipboard
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(cardText).then(() => {
                        // Show brief notification
                        setSaveStatus('saved');
                        setTimeout(() => setSaveStatus(''), 1500);
                    }).catch(err => {
                        console.log('Could not copy to clipboard', err);
                    });
                }
            };

            const handleSort = (field) => {
                if (sortField === field) {
                    setSortDirection(sortDirection === 'asc' ? 'desc' : 'asc');
                } else {
                    setSortField(field);
                    setSortDirection('asc');
                }
            };

            return (
                <div className="min-h-screen" style={{background: theme === 'liquid' ? 'linear-gradient(to bottom right, #0f172a, #1e3a8a, #581c87)' : ''}}>
                    {/* Header */}
                    <div className={`${t.header} shadow-lg sticky top-0 z-20`}>
                        <div className="max-w-7xl mx-auto px-4 py-6">
                            <div className="flex items-center justify-between flex-wrap gap-4">
                                <div className="flex items-center gap-4">
                                    <div>
                                        <h1 className={`text-3xl md:text-4xl font-bold ${t.headerText} flex items-center`}>
                                            <span className="mr-3">üèÄ</span>
                                            My MJ Collection
                                        </h1>
                                        <div className="flex items-center gap-3 mt-1">
                                            <p className={`${t.headerSubtext} text-sm`}>Smart Card Tracker</p>
                                            {saveStatus === 'saving' && <span className="text-yellow-300 text-xs animate-pulse">üíæ Saving...</span>}
                                            {saveStatus === 'saved' && <span className="text-green-300 text-xs">‚úì Saved</span>}
                                            {saveStatus === 'error' && <span className="text-red-300 text-xs">‚ö†Ô∏è Save failed</span>}
                                        </div>
                                    </div>
                                </div>
                                <div className="flex items-center gap-4">
                                    {/* Collection Switcher */}
                                    <div className="flex items-center gap-2">
                                        <select
                                            value={currentCollection}
                                            onChange={(e) => switchCollection(e.target.value)}
                                            className={`px-3 py-2 ${t.button} ${t.text} rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-white/20 cursor-pointer`}
                                        >
                                            {Object.entries(collections).map(([id, collection]) => (
                                                <option key={id} value={id}>
                                                    üìÅ {collection.name}
                                                </option>
                                            ))}
                                        </select>
                                        <button
                                            onClick={() => setShowCollectionManager(true)}
                                            className={`px-3 py-2 ${t.buttonPrimary} ${t.text} rounded-lg text-sm`}
                                            title="Manage Collections"
                                        >
                                            ‚öôÔ∏è
                                        </button>
                                    </div>
                                    {/* Stats */}
                                    <div className="grid grid-cols-2 md:grid-cols-5 gap-3 text-center">
                                        <div className={`${t.stat} rounded-lg p-3`}>
                                            <div className={`text-2xl font-bold ${t.statText}`}>{stats.uniqueCards}</div>
                                            <div className={`${t.statLabel} text-xs`}>Unique</div>
                                        </div>
                                        <div className={`${t.stat} rounded-lg p-3`}>
                                            <div className={`text-2xl font-bold ${t.statText}`}>{stats.totalCards}</div>
                                            <div className={`${t.statLabel} text-xs`}>Total</div>
                                        </div>
                                        <div className={`${t.stat} rounded-lg p-3`}>
                                            <div className={`text-2xl font-bold text-blue-400`}>${stats.currentValue}</div>
                                            <div className={`${t.statLabel} text-xs`}>Current</div>
                                        </div>
                                        <div className={`${t.stat} rounded-lg p-3`}>
                                            <div className={`text-2xl font-bold text-green-400`}>${stats.totalCost}</div>
                                            <div className={`${t.statLabel} text-xs`}>Cost</div>
                                        </div>
                                        <div className={`${t.stat} rounded-lg p-3`}>
                                            <div className={`text-2xl font-bold ${t.statText}`}>{stats.validatedCards}</div>
                                            <div className={`${t.statLabel} text-xs`}>Valid</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="max-w-7xl mx-auto px-4 py-6">
                        {/* Quick Actions */}
                        <div className="flex flex-wrap gap-4 mb-6">
                            <button
                                onClick={() => setShowAddModal(true)}
                                className="px-6 py-3 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors font-medium shadow-lg flex items-center gap-2"
                            >
                                <span className="text-xl">+</span> Add Card to Collection
                            </button>
                            <button
                                onClick={loadReferenceDB}
                                disabled={dbLoading || referenceDB}
                                className="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium shadow-lg disabled:opacity-50"
                            >
                                {dbLoading ? '‚è≥ Loading...' : referenceDB ? `‚úì Database Loaded (${referenceDB.length.toLocaleString()} cards)` : 'üìö Load Reference Database'}
                            </button>
                        </div>

                        {/* Database Info */}
                        {referenceDB && referenceDB.length < 100 && (
                            <div className="bg-yellow-900 bg-opacity-50 border border-yellow-600 rounded-lg p-5 mb-6">
                                <div className="flex items-start gap-4">
                                    <div className="text-4xl">‚ö†Ô∏è</div>
                                    <div className="flex-1">
                                        <div className="font-bold text-yellow-300 text-lg mb-2">Sample Data Only ({referenceDB.length} cards)</div>
                                        <div className="text-yellow-200 mb-3">
                                            You're using sample data instead of the full 16,232 card database. 
                                            To load the complete database, you need to run a web server.
                                        </div>
                                        <div className="bg-black bg-opacity-30 rounded-lg p-3 mb-3">
                                            <div className="text-yellow-100 font-mono text-sm mb-2">Quick Setup:</div>
                                            <div className="text-white font-mono text-xs space-y-1">
                                                <div>1. Open terminal/command prompt in the folder with your files</div>
                                                <div>2. Run: <span className="bg-gray-800 px-2 py-1 rounded">python -m http.server 8000</span></div>
                                                <div>3. Open: <span className="bg-gray-800 px-2 py-1 rounded">http://localhost:8000/</span></div>
                                                <div>4. Click "Load Reference Database" again</div>
                                            </div>
                                        </div>
                                        <div className="text-xs text-yellow-300">
                                            üí° You can still add cards manually with sample data, but autocomplete will be limited.
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                        
                        {referenceDB && referenceDB.length >= 100 && (
                            <div className="bg-gradient-to-r from-green-900 to-green-800 bg-opacity-50 border border-green-600 rounded-lg p-4 mb-6">
                                <div className="flex items-center justify-between flex-wrap gap-4">
                                    <div className="flex items-center gap-3">
                                        <div className="text-3xl">‚úÖ</div>
                                        <div>
                                            <div className="font-bold text-white">Full Database Loaded!</div>
                                            <div className="text-sm text-green-200">
                                                {referenceDB.length.toLocaleString()} cards searchable ‚Ä¢ Autocomplete enabled ‚Ä¢ Click "Add Card" to search
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Filter */}
                        <div className="bg-gray-800 rounded-lg shadow-xl p-4 mb-6">
                            <div className="flex gap-4">
                                <input
                                    type="text"
                                    value={filterText}
                                    onChange={(e) => setFilterText(e.target.value)}
                                    placeholder="üîç Filter your collection..."
                                    className="flex-1 px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-red-600"
                                />
                                <button
                                    onClick={() => setFilterText('')}
                                    className="px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-colors"
                                >
                                    Clear
                                </button>
                            </div>
                            <div className="mt-2 text-sm text-gray-400">
                                Showing {filteredCollection.length} of {myCollection.length} cards in your collection
                            </div>
                        </div>

                        {/* Collection Table */}
                        {myCollection.length === 0 ? (
                            <div className="bg-gray-800 rounded-lg shadow-xl p-12 text-center">
                                <div className="text-6xl mb-4">üèÄ</div>
                                <h2 className="text-2xl font-bold text-white mb-2">Start Your Collection</h2>
                                <p className="text-gray-400 mb-6">Click "Add Card to Collection" to begin tracking your MJ cards</p>
                                <button
                                    onClick={() => setShowAddModal(true)}
                                    className="px-8 py-4 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors font-medium text-lg"
                                >
                                    Add Your First Card
                                </button>
                            </div>
                        ) : mobileView ? (
                            /* Mobile Card View */
                            <div className="space-y-4">
                                {filteredCollection.map((card) => (
                                    <div key={card.id} className={`${t.card} rounded-lg shadow-xl p-4 border-l-4 border-blue-600 cursor-pointer`} onClick={() => openCardDetail(card)}>
                                        {/* Card Image Thumbnail */}
                                        {card.imageUrl && (
                                            <div className="mb-3">
                                                <img 
                                                    src={card.imageUrl} 
                                                    alt={card.description}
                                                    className="w-full h-48 object-contain rounded bg-gray-900"
                                                    onError={(e) => e.target.style.display = 'none'}
                                                />
                                            </div>
                                        )}
                                        
                                        <div className="flex justify-between items-start mb-3" onClick={(e) => e.stopPropagation()}>
                                            <div className="flex-1">
                                                <div className="flex items-center gap-2 mb-1">
                                                    {card.validated && <span className="text-green-400 text-sm">‚úì</span>}
                                                    <h3 className={`font-semibold ${t.text}`}>{card.description}</h3>
                                                </div>
                                                <div className={`text-sm ${t.textMuted}`}>
                                                    {card.year} ‚Ä¢ {card.brand} {card.cardNumber && `‚Ä¢ #${card.cardNumber}`}
                                                </div>
                                                {card.priceHistory && card.priceHistory.length > 0 && (
                                                    <div className="text-xs bg-green-600 text-white px-2 py-0.5 rounded-full inline-block mt-1">
                                                        {card.priceHistory.length} price record{card.priceHistory.length > 1 ? 's' : ''}
                                                    </div>
                                                )}
                                            </div>
                                            <button
                                                onClick={(e) => { e.stopPropagation(); deleteCard(card.id); }}
                                                className={`${t.buttonDanger} text-white px-3 py-1 text-sm rounded transition-colors ml-2`}
                                            >
                                                üóëÔ∏è
                                            </button>
                                        </div>
                                        
                                        <div className="grid grid-cols-2 gap-3 mb-3">
                                            <div>
                                                <label className="text-xs text-gray-400 block mb-1">Quantity</label>
                                                <input
                                                    type="number"
                                                    min="1"
                                                    value={card.quantity}
                                                    onChange={(e) => updateCard(card.id, { quantity: parseInt(e.target.value) || 1 })}
                                                    className="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white focus:outline-none focus:ring-2 focus:ring-red-600"
                                                />
                                            </div>
                                            <div>
                                                <label className="text-xs text-gray-400 block mb-1">Price</label>
                                                <input
                                                    type="text"
                                                    value={card.purchasePrice}
                                                    onChange={(e) => updateCard(card.id, { purchasePrice: e.target.value })}
                                                    placeholder="$0.00"
                                                    className="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-red-600"
                                                />
                                            </div>
                                            <div>
                                                <label className="text-xs text-gray-400 block mb-1">Grade</label>
                                                <input
                                                    type="text"
                                                    value={card.grade}
                                                    onChange={(e) => updateCard(card.id, { grade: e.target.value })}
                                                    placeholder="PSA/BGS"
                                                    className="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-red-600"
                                                />
                                            </div>
                                            <div>
                                                <label className="text-xs text-gray-400 block mb-1">Notes</label>
                                                <input
                                                    type="text"
                                                    value={card.notes}
                                                    onChange={(e) => updateCard(card.id, { notes: e.target.value })}
                                                    placeholder="Notes..."
                                                    className="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-red-600"
                                                />
                                            </div>
                                        </div>
                                        
                                        <div className="grid grid-cols-2 gap-2" onClick={(e) => e.stopPropagation()}>
                                            <button
                                                onClick={(e) => { e.stopPropagation(); openAddPrice(card); }}
                                                className={`${t.buttonPrimary} text-white px-3 py-2 text-sm rounded transition-colors`}
                                            >
                                                üìù Price
                                            </button>
                                            <button
                                                onClick={(e) => { e.stopPropagation(); findAndSaveImage(card); }}
                                                className={`${t.buttonPurple} text-white px-3 py-2 text-sm rounded transition-colors`}
                                            >
                                                {card.imageUrl ? 'üñºÔ∏è View' : '‚ûï Image'}
                                            </button>
                                            <button
                                                onClick={(e) => { e.stopPropagation(); searchCardImage(card); }}
                                                className={`${t.buttonPrimary} text-white px-3 py-2 text-sm rounded transition-colors`}
                                            >
                                                üîç Search
                                            </button>
                                            <button
                                                onClick={(e) => { e.stopPropagation(); checkPrice(card); }}
                                                className={`${t.buttonSuccess} text-white px-3 py-2 text-sm rounded transition-colors`}
                                            >
                                                üí∞ 130point
                                            </button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        ) : (
                            /* Desktop Table View */
                            <div className={`${t.card} rounded-lg shadow-xl overflow-hidden`}>
                                <div className="scrollable-table">
                                    <table className="w-full">
                                        <thead className="sticky-header">
                                            <tr className={`text-left text-sm font-semibold ${t.text} border-b ${t.cardBorder}`}>
                                                <th className={`px-4 py-3 cursor-pointer hover:bg-opacity-50`} onClick={() => handleSort('description')}>
                                                    Card {sortField === 'description' && (sortDirection === 'asc' ? '‚ñ≤' : '‚ñº')}
                                                </th>
                                                <th className={`px-4 py-3 cursor-pointer hover:bg-opacity-50`} onClick={() => handleSort('year')}>
                                                    Year {sortField === 'year' && (sortDirection === 'asc' ? '‚ñ≤' : '‚ñº')}
                                                </th>
                                                <th className={`px-4 py-3 cursor-pointer hover:bg-opacity-50`} onClick={() => handleSort('brand')}>
                                                    Brand {sortField === 'brand' && (sortDirection === 'asc' ? '‚ñ≤' : '‚ñº')}
                                                </th>
                                                <th className="px-4 py-3">Card #</th>
                                                <th className="px-4 py-3" title="Breakdown by grade">Grades</th>
                                                <th className="px-4 py-3 text-center" title="Total quantity across all grades">Total Qty</th>
                                                <th className="px-4 py-3" title="Current market value (from price history) or purchase cost">Current Value</th>
                                                <th className="px-4 py-3" title="Total investment across all variants">Total Cost</th>
                                                <th className="px-4 py-3">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody className={`divide-y ${t.cardBorder}`}>
                                            {filteredCollection.map((card) => {
                                                const totalQty = (card.variants || []).reduce((sum, v) => sum + (v.quantity || 0), 0);
                                                const totalCost = (card.variants || []).reduce((sum, v) => {
                                                    const price = parseFloat(v.purchasePrice) || 0;
                                                    return sum + (price * (v.quantity || 0));
                                                }, 0);
                                                const variantCount = (card.variants || []).length;
                                                
                                                // Grade breakdown
                                                const gradeBreakdown = {};
                                                (card.variants || []).forEach(v => {
                                                    const gradeKey = v.gradeCompany && v.gradeCompany !== 'Raw' 
                                                        ? `${v.gradeCompany} ${v.gradeValue}` 
                                                        : 'Raw';
                                                    gradeBreakdown[gradeKey] = (gradeBreakdown[gradeKey] || 0) + (v.quantity || 0);
                                                });
                                                
                                                // Current value calculation
                                                let currentValue = 0;
                                                let hasValue = false;
                                                
                                                (card.variants || []).forEach(variant => {
                                                    const qty = variant.quantity || 0;
                                                    const gradeKey = variant.gradeCompany && variant.gradeCompany !== 'Raw'
                                                        ? `${variant.gradeCompany} ${variant.gradeValue}`
                                                        : 'Raw';
                                                    
                                                    // Find matching price history entry for this grade
                                                    const matchingPrices = (card.priceHistory || []).filter(p => {
                                                        const priceGrade = p.gradeCompany && p.gradeCompany !== 'Raw'
                                                            ? `${p.gradeCompany} ${p.gradeValue}`
                                                            : 'Raw';
                                                        return priceGrade === gradeKey;
                                                    });
                                                    
                                                    if (matchingPrices.length > 0) {
                                                        // Use latest price entry
                                                        const latestPrice = matchingPrices.sort((a, b) => 
                                                            new Date(b.date) - new Date(a.date)
                                                        )[0];
                                                        currentValue += (latestPrice.price || 0) * qty;
                                                        hasValue = true;
                                                    } else if (variant.purchasePrice) {
                                                        // Use purchase cost
                                                        currentValue += (parseFloat(variant.purchasePrice) || 0) * qty;
                                                        hasValue = true;
                                                    }
                                                });
                                                
                                                return (
                                                <tr key={card.id} className={`hover:bg-opacity-50 transition-colors cursor-pointer`} onClick={() => openCardDetail(card)}>
                                                    <td className="px-4 py-3">
                                                        <div className="flex items-center gap-2">
                                                            {card.validated && <span className="text-green-400" title="Validated from database">‚úì</span>}
                                                            <span className="text-sm font-medium text-blue-400 hover:text-blue-300">{card.description}</span>
                                                            {variantCount > 1 && (
                                                                <span className="text-xs bg-blue-600 text-white px-2 py-0.5 rounded-full">
                                                                    {variantCount} variant{variantCount > 1 ? 's' : ''}
                                                                </span>
                                                            )}
                                                            {card.priceHistory && card.priceHistory.length > 0 && (
                                                                <span className="text-xs bg-green-600 text-white px-2 py-0.5 rounded-full">
                                                                    {card.priceHistory.length} price{card.priceHistory.length > 1 ? 's' : ''}
                                                                </span>
                                                            )}
                                                        </div>
                                                    </td>
                                                    <td className={`px-4 py-3 text-sm ${t.textMuted}`}>{card.year}</td>
                                                    <td className={`px-4 py-3 text-sm ${t.textMuted}`}>{card.brand}</td>
                                                    <td className={`px-4 py-3 text-sm ${t.textMuted}`}>{card.cardNumber}</td>
                                                    <td className="px-4 py-3">
                                                        <div className="flex flex-wrap gap-1">
                                                            {Object.entries(gradeBreakdown).map(([grade, qty]) => (
                                                                <span 
                                                                    key={grade}
                                                                    className={`text-xs px-2 py-1 rounded ${
                                                                        grade === 'Raw' 
                                                                            ? 'bg-gray-600 text-white' 
                                                                            : 'bg-blue-600 text-white'
                                                                    }`}
                                                                    title={`${qty} card${qty > 1 ? 's' : ''} in ${grade}`}
                                                                >
                                                                    {grade}: {qty}
                                                                </span>
                                                            ))}
                                                        </div>
                                                    </td>
                                                    <td className={`px-4 py-3 text-center text-lg font-bold ${t.text}`}>
                                                        {totalQty}
                                                    </td>
                                                    <td className={`px-4 py-3 text-sm ${hasValue ? 'text-blue-400 font-semibold' : t.textMuted}`}>
                                                        {hasValue ? `$${currentValue.toLocaleString()}` : 'N/A'}
                                                    </td>
                                                    <td className={`px-4 py-3 text-sm ${totalCost > 0 ? 'text-green-400 font-semibold' : t.textMuted}`}>
                                                        {totalCost > 0 ? `$${totalCost.toLocaleString()}` : '-'}
                                                    </td>
                                                    <td className="px-4 py-3" onClick={(e) => e.stopPropagation()}>
                                                        <div className="flex gap-2">
                                                            <button
                                                                onClick={(e) => { e.stopPropagation(); openAddPrice(card); }}
                                                                className="px-2 py-1 bg-yellow-600 hover:bg-yellow-700 text-white text-xs rounded transition-colors"
                                                                title="Record price"
                                                            >
                                                                üìù
                                                            </button>
                                                            <button
                                                                onClick={(e) => { e.stopPropagation(); findAndSaveImage(card); }}
                                                                className="px-2 py-1 bg-purple-600 hover:bg-purple-700 text-white text-xs rounded transition-colors"
                                                                title="Add/view card image"
                                                            >
                                                                {card.imageUrl ? 'üñºÔ∏è' : '‚ûïüñºÔ∏è'}
                                                            </button>
                                                            <button
                                                                onClick={(e) => { e.stopPropagation(); searchCardImage(card); }}
                                                                className="px-2 py-1 bg-blue-600 hover:bg-blue-700 text-white text-xs rounded transition-colors"
                                                                title="Search images online"
                                                            >
                                                                üîç
                                                            </button>
                                                            <button
                                                                onClick={(e) => { e.stopPropagation(); checkPrice(card); }}
                                                                className="px-2 py-1 bg-green-600 hover:bg-green-700 text-white text-xs rounded transition-colors"
                                                                title="Check price"
                                                            >
                                                                üí∞
                                                            </button>
                                                            <button
                                                                onClick={(e) => { e.stopPropagation(); deleteCard(card.id); }}
                                                                className={`px-2 py-1 ${t.buttonDanger} text-white text-xs rounded transition-colors`}
                                                                title="Delete"
                                                            >
                                                                üóëÔ∏è
                                                            </button>
                                                        </div>
                                                    </td>
                                                </tr>
                                                );
                                            })}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}

                        {/* Export/Import */}
                        <div className={`mt-6 ${t.card} rounded-lg shadow-xl p-6`}>
                            <h3 className={`text-xl font-bold ${t.text} mb-4`}>üìä Collection Management</h3>
                            
                            {/* Export Options */}
                            <div className="mb-6">
                                <h4 className={`text-sm font-semibold ${t.text} mb-3`}>Export Collection</h4>
                                <div className="grid grid-cols-1 md:grid-cols-4 gap-3">
                                    <button
                                        onClick={() => {
                                            const data = JSON.stringify(myCollection, null, 2);
                                            const blob = new Blob([data], { type: 'application/json' });
                                            const url = URL.createObjectURL(blob);
                                            const a = document.createElement('a');
                                            a.href = url;
                                            a.download = `mj-collection-${new Date().toISOString().split('T')[0]}.json`;
                                            a.click();
                                            URL.revokeObjectURL(url);
                                        }}
                                        className={`${t.button} text-white px-4 py-3 rounded-lg transition-colors font-medium text-sm`}
                                    >
                                        üìÑ JSON
                                    </button>
                                    <button
                                        onClick={exportToCSV}
                                        className={`${t.buttonSuccess} text-white px-4 py-3 rounded-lg transition-colors font-medium text-sm`}
                                    >
                                        üìä CSV
                                    </button>
                                    <button
                                        onClick={exportToXLSX}
                                        className={`${t.buttonPrimary} text-white px-4 py-3 rounded-lg transition-colors font-medium text-sm`}
                                    >
                                        üìà Excel
                                    </button>
                                    <button
                                        onClick={exportToGoogleSheets}
                                        className={`${t.buttonPrimary} text-white px-4 py-3 rounded-lg transition-colors font-medium text-sm`}
                                    >
                                        üìë Google Sheets
                                    </button>
                                </div>
                                <div className={`mt-2 text-xs ${t.textMuted}`}>
                                    <strong>JSON:</strong> Full backup with all data ‚Ä¢ 
                                    <strong> CSV:</strong> Spreadsheet compatible ‚Ä¢ 
                                    <strong> Excel:</strong> 2 sheets (Summary + Details) ‚Ä¢ 
                                    <strong> Google Sheets:</strong> Copy & paste ready
                                </div>
                            </div>

                            {/* Import/Reset Options */}
                            <div>
                                <h4 className={`text-sm font-semibold ${t.text} mb-3`}>Import & Reset</h4>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                                    <button
                                        onClick={() => {
                                            const input = document.createElement('input');
                                            input.type = 'file';
                                            input.accept = 'application/json';
                                            input.onchange = (e) => {
                                                const file = e.target.files[0];
                                                const reader = new FileReader();
                                                reader.onload = (event) => {
                                                    try {
                                                        const imported = JSON.parse(event.target.result);
                                                        saveMyCollection(imported);
                                                        alert('Collection imported successfully!');
                                                    } catch (error) {
                                                        alert('Error importing collection.');
                                                    }
                                                };
                                                reader.readAsText(file);
                                            };
                                            input.click();
                                        }}
                                        className={`${t.buttonSuccess} text-white px-6 py-3 rounded-lg transition-colors font-medium`}
                                    >
                                        üì§ Import JSON
                                    </button>
                                    <button
                                        onClick={() => {
                                            if (confirm('Reset your entire collection? This cannot be undone!')) {
                                                saveMyCollection([]);
                                            }
                                        }}
                                        className={`${t.buttonDanger} text-white px-6 py-3 rounded-lg transition-colors font-medium`}
                                    >
                                        üîÑ Reset Collection
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Add Card Modal */}
                    {showAddModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4 overflow-y-auto">
                            <div className={`${t.card} rounded-lg shadow-2xl max-w-2xl w-full my-8 max-h-[90vh] overflow-hidden flex flex-col`}>
                                <div className={`${t.card} border-b ${t.cardBorder} p-4 md:p-6 flex justify-between items-center flex-shrink-0`}>
                                    <h2 className={`text-xl md:text-2xl font-bold ${t.text}`}>Add Card to Collection</h2>
                                    <button
                                        onClick={() => { setShowAddModal(false); resetForm(); }}
                                        className={`${t.textMuted} hover:${t.text} text-3xl leading-none min-h-[44px] min-w-[44px] flex items-center justify-center`}
                                    >
                                        √ó
                                    </button>
                                </div>
                                
                                <div className="p-4 md:p-6 space-y-4 overflow-y-auto flex-1">
                                    {/* Database Info Banner */}
                                    {referenceDB && (
                                        <div className={`${t.card} border ${t.cardBorder} rounded-lg p-4`}>
                                            <div className="flex items-start gap-3">
                                                <div className="text-2xl">üí°</div>
                                                <div className="flex-1 text-sm">
                                                    <div className={`font-semibold ${t.text} mb-1`}>Search Tips:</div>
                                                    <ul className={`${t.textMuted} space-y-1`}>
                                                        <li>‚Ä¢ Search {referenceDB.length.toLocaleString()} cards in the database</li>
                                                        <li>‚Ä¢ Try: "1989 Hoops", "Fleer 57", "Metal Universe"</li>
                                                        <li>‚Ä¢ Use multiple words to narrow results</li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    )}
                                    
                                    {!referenceDB && (
                                        <div className={`${t.card} border border-yellow-600 rounded-lg p-4`}>
                                            <div className="flex items-start gap-3">
                                                <div className="text-2xl">‚ö†Ô∏è</div>
                                                <div className="flex-1 text-sm">
                                                    <div className="font-semibold text-yellow-300 mb-1">Database Not Loaded</div>
                                                    <p className="text-yellow-200 mb-2">
                                                        You can add cards manually, or load the database for autocomplete.
                                                    </p>
                                                    <button
                                                        onClick={loadReferenceDB}
                                                        disabled={dbLoading}
                                                        className={`px-4 py-2 ${t.buttonPrimary} text-white rounded-lg transition-colors text-sm font-medium disabled:opacity-50`}
                                                    >
                                                        {dbLoading ? 'Loading 16,232 cards...' : 'Load Database Now'}
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    )}
                                    
                                    {/* Search with Autocomplete */}
                                    <div className="relative">
                                        <label className={`block text-sm font-medium ${t.text} mb-2`}>
                                            Card Search
                                            {referenceDB && <span className="text-xs text-green-400 ml-2">‚úì {referenceDB.length.toLocaleString()} cards</span>}
                                        </label>
                                        <input
                                            ref={searchInputRef}
                                            type="text"
                                            value={searchInput}
                                            onChange={(e) => handleSearchInput(e.target.value)}
                                            onFocus={() => suggestions.length > 0 && setShowSuggestions(true)}
                                            placeholder="Type year, brand, card number... (e.g., '1989 Hoops' or 'Fleer 57')"
                                            className={`w-full px-4 py-3 ${t.input} rounded-lg placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-600`}
                                        />
                                        {searchInput.length >= 2 && referenceDB && (
                                            <div className={`mt-1 text-xs ${t.textMuted}`}>
                                                {dbLoading ? 'Searching...' : `${suggestions.length} match${suggestions.length !== 1 ? 'es' : ''} found`}
                                            </div>
                                        )}
                                        {showSuggestions && suggestions.length > 0 && (
                                            <div className={`autocomplete-dropdown w-full mt-1 ${t.card} border ${t.cardBorder}`}>
                                                {suggestions.map((suggestion, idx) => (
                                                    <div
                                                        key={idx}
                                                        onClick={() => selectSuggestion(suggestion)}
                                                        className={`autocomplete-item hover:bg-opacity-50 ${t.text}`}
                                                    >
                                                        <div className="font-medium">{suggestion.description}</div>
                                                        <div className={`text-xs ${t.textMuted} mt-1`}>
                                                            {suggestion.year} ‚Ä¢ {suggestion.brand} 
                                                            {suggestion.cardNumber && ` ‚Ä¢ #${suggestion.cardNumber}`}
                                                        </div>
                                                    </div>
                                                ))}
                                                {suggestions.length === 20 && (
                                                    <div className={`px-4 py-2 text-xs text-yellow-400 ${t.card} border-t ${t.cardBorder}`}>
                                                        Showing first 20 results. Type more to narrow search.
                                                    </div>
                                                )}
                                            </div>
                                        )}
                                        {selectedCard && (
                                            <div className={`mt-2 p-3 ${t.card} border border-green-600 rounded-lg`}>
                                                <div className="text-sm text-green-400">‚úì Card validated from database</div>
                                                <div className={`text-xs ${t.textMuted} mt-1`}>
                                                    {selectedCard.year} ‚Ä¢ {selectedCard.brand} ‚Ä¢ #{selectedCard.cardNumber}
                                                </div>
                                            </div>
                                        )}
                                    </div>

                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className={`block text-sm font-medium ${t.text} mb-2`}>Quantity</label>
                                            <input
                                                type="number"
                                                min="1"
                                                value={quantity}
                                                onChange={(e) => setQuantity(e.target.value)}
                                                className={`w-full px-4 py-3 ${t.input} rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600`}
                                            />
                                        </div>
                                        <div>
                                            <label className={`block text-sm font-medium ${t.text} mb-2`}>Purchase Price (Optional)</label>
                                            <input
                                                type="text"
                                                value={purchasePrice}
                                                onChange={(e) => setPurchasePrice(e.target.value)}
                                                placeholder="$0.00 (leave blank if unknown)"
                                                className={`w-full px-4 py-3 ${t.input} rounded-lg placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-600`}
                                            />
                                        </div>
                                    </div>

                                    <div>
                                        <label className={`block text-sm font-medium ${t.text} mb-2`}>Grade/Condition (Optional)</label>
                                        <div className="grid grid-cols-2 gap-4">
                                            <div>
                                                <label className={`block text-xs ${t.textMuted} mb-2`}>Company</label>
                                                <select
                                                    value={grade.match(/PSA|BGS|SGC|CGC/i)?.[0] || ''}
                                                    onChange={(e) => {
                                                        const company = e.target.value;
                                                        if (!company) {
                                                            setGrade('Raw');
                                                        } else {
                                                            const value = grade.match(/\d+\.?\d*/)?.[0] || '';
                                                            setGrade(company + (value ? ' ' + value : ''));
                                                        }
                                                    }}
                                                    className={`w-full px-4 py-3 ${t.input} rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600`}
                                                >
                                                    <option value="">Raw/Ungraded</option>
                                                    <option value="PSA">PSA</option>
                                                    <option value="BGS">BGS (Beckett)</option>
                                                    <option value="SGC">SGC</option>
                                                    <option value="CGC">CGC</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label className={`block text-xs ${t.textMuted} mb-2`}>Grade</label>
                                                <select
                                                    value={grade.match(/\d+\.?\d*|Authentic/)?.[0] || ''}
                                                    onChange={(e) => {
                                                        const company = grade.match(/PSA|BGS|SGC|CGC/i)?.[0] || '';
                                                        const value = e.target.value;
                                                        if (company && value) {
                                                            setGrade(company + ' ' + value);
                                                        } else if (value) {
                                                            setGrade(value);
                                                        }
                                                    }}
                                                    disabled={!grade || grade === 'Raw'}
                                                    className={`w-full px-4 py-3 ${t.input} rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600 disabled:opacity-50`}
                                                >
                                                    <option value="">Select Grade</option>
                                                    <option value="10">10 - Gem Mint</option>
                                                    <option value="9.5">9.5 - Mint+</option>
                                                    <option value="9">9 - Mint</option>
                                                    <option value="8.5">8.5 - NM-Mint+</option>
                                                    <option value="8">8 - NM-Mint</option>
                                                    <option value="7.5">7.5 - NM+</option>
                                                    <option value="7">7 - Near Mint</option>
                                                    <option value="Authentic">Authentic</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div className={`text-xs ${t.textMuted} mt-1`}>
                                            Select grading company and grade, or leave as Raw/Ungraded
                                        </div>
                                    </div>

                                    <div>
                                        <label className={`block text-sm font-medium ${t.text} mb-2`}>Notes (Optional)</label>
                                        <textarea
                                            value={notes}
                                            onChange={(e) => setNotes(e.target.value)}
                                            placeholder="Purchase location, condition notes, etc."
                                            rows="3"
                                            className={`w-full px-4 py-3 ${t.input} rounded-lg placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-600`}
                                        />
                                    </div>

                                    {/* Info Box */}
                                    <div className={`${t.card} border ${t.cardBorder} rounded-lg p-4`}>
                                        <div className="flex items-start gap-3">
                                            <div className="text-2xl">üí°</div>
                                            <div className="flex-1 text-sm">
                                                <div className={`font-semibold ${t.text} mb-1`}>Adding Multiple Grades</div>
                                                <p className={t.textMuted}>
                                                    This adds your first copy. To track the same card in different conditions (e.g., PSA 10, PSA 8, Raw), 
                                                    click the card after adding to open details, then use "‚ûï Add Copy" button.
                                                </p>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="flex gap-4 pt-4">
                                        <button
                                            onClick={addCardToCollection}
                                            className={`flex-1 px-6 py-3 ${t.buttonSuccess} text-white rounded-lg transition-colors font-medium`}
                                        >
                                            Add to Collection
                                        </button>
                                        <button
                                            onClick={() => { setShowAddModal(false); resetForm(); }}
                                            className={`px-6 py-3 ${t.button} text-white rounded-lg transition-colors font-medium`}
                                        >
                                            Cancel
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Image Modal */}
                    {showImageModal && currentImageCard && (
                        <div className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4 overflow-y-auto">
                            <div className={`${t.card} rounded-lg shadow-2xl max-w-2xl w-full my-8 max-h-[90vh] overflow-hidden flex flex-col`}>
                                <div className={`${t.card} border-b ${t.cardBorder} p-4 md:p-6 flex justify-between items-center flex-shrink-0`}>
                                    <h2 className={`text-xl md:text-2xl font-bold ${t.text}`}>Card Image</h2>
                                    <button
                                        onClick={() => setShowImageModal(false)}
                                        className={`${t.textMuted} hover:${t.text} text-3xl leading-none min-h-[44px] min-w-[44px] flex items-center justify-center`}
                                    >
                                        √ó
                                    </button>
                                </div>
                                
                                <div className="p-4 md:p-6 space-y-4 overflow-y-auto flex-1">
                                    {/* Card Info */}
                                    <div className="bg-gray-700 rounded-lg p-4">
                                        <div className="font-semibold text-white mb-1">{currentImageCard.description}</div>
                                        <div className="text-sm text-gray-400">
                                            {currentImageCard.year} ‚Ä¢ {currentImageCard.brand} 
                                            {currentImageCard.cardNumber && ` ‚Ä¢ #${currentImageCard.cardNumber}`}
                                        </div>
                                    </div>

                                    {/* Current Image Preview */}
                                    {currentImageCard.imageUrl && (
                                        <div className="bg-gray-700 rounded-lg p-4">
                                            <div className="text-sm font-medium text-gray-300 mb-2">Current Image:</div>
                                            <img 
                                                src={currentImageCard.imageUrl} 
                                                alt={currentImageCard.description}
                                                className="max-w-full h-auto max-h-96 mx-auto rounded border-2 border-gray-600"
                                                onError={(e) => {
                                                    e.target.style.display = 'none';
                                                    e.target.nextSibling.style.display = 'block';
                                                }}
                                            />
                                            <div style={{display: 'none'}} className="text-red-400 text-sm text-center py-4">
                                                ‚ö†Ô∏è Image failed to load. The URL may be invalid or the image was removed.
                                            </div>
                                        </div>
                                    )}

                                    {/* Instructions */}
                                    <div className="bg-blue-900 bg-opacity-30 border border-blue-600 rounded-lg p-4">
                                        <div className="text-blue-300 font-semibold mb-2">üìù How to Add an Image:</div>
                                        <ol className="text-blue-200 text-sm space-y-2">
                                            <li>1. Click "Search Images" below to find card photos</li>
                                            <li>2. Right-click an image ‚Üí "Copy image address"</li>
                                            <li>3. Paste the URL in the box below</li>
                                            <li>4. Click "Save Image" to attach to this card</li>
                                        </ol>
                                        <div className="mt-3 text-xs text-blue-300">
                                            üí° Tip: Use high-quality images from eBay, COMC, or card grading sites
                                        </div>
                                    </div>

                                    {/* Image URL Input */}
                                    <div>
                                        <label className="block text-sm font-medium text-gray-300 mb-2">
                                            Image URL
                                        </label>
                                        <input
                                            type="url"
                                            value={selectedImageUrl}
                                            onChange={(e) => setSelectedImageUrl(e.target.value)}
                                            placeholder="https://example.com/card-image.jpg"
                                            className="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-600"
                                        />
                                        <div className="mt-2 text-xs text-gray-400">
                                            Paste the direct image URL (ending in .jpg, .png, .webp, etc.)
                                        </div>
                                    </div>

                                    {/* Image Preview */}
                                    {selectedImageUrl && selectedImageUrl !== currentImageCard.imageUrl && (
                                        <div>
                                            <div className="text-sm font-medium text-gray-300 mb-2">Preview:</div>
                                            <img 
                                                src={selectedImageUrl} 
                                                alt="Preview"
                                                className="max-w-full h-auto max-h-64 mx-auto rounded border-2 border-purple-600"
                                                onError={(e) => {
                                                    e.target.style.display = 'none';
                                                    e.target.nextSibling.style.display = 'block';
                                                }}
                                            />
                                            <div style={{display: 'none'}} className="text-red-400 text-sm text-center py-4">
                                                ‚ö†Ô∏è Invalid image URL. Please check the URL and try again.
                                            </div>
                                        </div>
                                    )}

                                    {/* Action Buttons */}
                                    <div className="flex flex-col sm:flex-row gap-3 pt-4">
                                        <button
                                            onClick={() => searchCardImage(currentImageCard)}
                                            className="flex-1 px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium"
                                        >
                                            üîç Search Images Online
                                        </button>
                                        <button
                                            onClick={() => saveCardImage(selectedImageUrl)}
                                            disabled={!selectedImageUrl || selectedImageUrl === currentImageCard.imageUrl}
                                            className="flex-1 px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed"
                                        >
                                            üíæ Save Image
                                        </button>
                                    </div>

                                    {/* Remove Image Button */}
                                    {currentImageCard.imageUrl && (
                                        <button
                                            onClick={removeCardImage}
                                            className="w-full px-6 py-3 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors font-medium"
                                        >
                                            üóëÔ∏è Remove Image
                                        </button>
                                    )}

                                    <button
                                        onClick={() => setShowImageModal(false)}
                                        className="w-full px-6 py-3 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-colors font-medium"
                                    >
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Card Detail Modal */}
                    {showCardDetailModal && detailCard && (
                        <div className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4 overflow-y-auto">
                            <div className={`${t.card} rounded-lg shadow-2xl max-w-4xl w-full my-8 max-h-[90vh] overflow-hidden flex flex-col`}>
                                <div className={`${t.card} border-b ${t.cardBorder} p-4 md:p-6 flex justify-between items-center flex-shrink-0`}>
                                    <h2 className={`text-xl md:text-2xl font-bold ${t.text}`}>Card Details</h2>
                                    <button
                                        onClick={() => setShowCardDetailModal(false)}
                                        className={`${t.textMuted} hover:${t.text} text-3xl leading-none min-h-[44px] min-w-[44px] flex items-center justify-center`}
                                    >
                                        √ó
                                    </button>
                                </div>
                                
                                <div className="p-4 md:p-6 space-y-6 overflow-y-auto flex-1">
                                    {/* Card Image */}
                                    {detailCard.imageUrl && (
                                        <div className={`${t.card} rounded-lg p-4 text-center`}>
                                            <img 
                                                src={detailCard.imageUrl} 
                                                alt={detailCard.description}
                                                className="max-w-full h-auto max-h-96 mx-auto rounded"
                                                onError={(e) => e.target.style.display = 'none'}
                                            />
                                        </div>
                                    )}

                                    {/* Card Information */}
                                    <div className={`${t.card} rounded-lg p-4`}>
                                        <h3 className={`text-lg font-bold ${t.text} mb-4 flex items-center gap-2`}>
                                            üìá Card Information
                                            {detailCard.validated && <span className="text-green-400 text-sm">‚úì Validated</span>}
                                        </h3>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                            <div>
                                                <div className={`text-xs ${t.textMuted} mb-1`}>Description</div>
                                                <div className={`${t.text} font-medium`}>{detailCard.description}</div>
                                            </div>
                                            <div>
                                                <div className={`text-xs ${t.textMuted} mb-1`}>Year</div>
                                                <div className={t.text}>{detailCard.year || 'N/A'}</div>
                                            </div>
                                            <div>
                                                <div className={`text-xs ${t.textMuted} mb-1`}>Brand</div>
                                                <div className={t.text}>{detailCard.brand || 'N/A'}</div>
                                            </div>
                                            <div>
                                                <div className={`text-xs ${t.textMuted} mb-1`}>Card Number</div>
                                                <div className={t.text}>{detailCard.cardNumber || 'N/A'}</div>
                                            </div>
                                            <div>
                                                <div className={`text-xs ${t.textMuted} mb-1`}>Serial Number</div>
                                                <div className={t.text}>{detailCard.serialNumber || 'N/A'}</div>
                                            </div>
                                            <div>
                                                <div className={`text-xs ${t.textMuted} mb-1`}>Date Added</div>
                                                <div className={t.text}>{new Date(detailCard.dateAdded).toLocaleDateString()}</div>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Card Variants (Owned Copies) */}
                                    <div className={`${t.card} rounded-lg p-4`}>
                                        <div className="flex items-center justify-between mb-4">
                                            <h3 className={`text-lg font-bold ${t.text} flex items-center gap-2`}>
                                                üé¥ Owned Copies
                                                <span className="text-sm bg-blue-600 text-white px-2 py-1 rounded-full">
                                                    {(detailCard.variants || []).length} variant{(detailCard.variants || []).length !== 1 ? 's' : ''}
                                                </span>
                                            </h3>
                                            <button
                                                onClick={() => { setShowCardDetailModal(false); openAddVariant(detailCard); }}
                                                className={`${t.buttonPrimary} text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors`}
                                            >
                                                ‚ûï Add Copy
                                            </button>
                                        </div>

                                        <div className="space-y-3">
                                            {(detailCard.variants || []).map((variant) => (
                                                <div key={variant.id} className={`${t.card} border ${t.cardBorder} rounded-lg p-4`}>
                                                    <div className="flex items-start justify-between gap-4">
                                                        <div className="flex-1">
                                                            <div className="flex items-center gap-3 mb-2">
                                                                {variant.gradeCompany && variant.gradeCompany !== 'Raw' ? (
                                                                    <div className="bg-blue-600 text-white px-3 py-1 rounded-full text-sm font-bold">
                                                                        {variant.gradeCompany} {variant.gradeValue}
                                                                    </div>
                                                                ) : (
                                                                    <div className="bg-gray-600 text-white px-3 py-1 rounded-full text-sm">
                                                                        Raw/Ungraded
                                                                    </div>
                                                                )}
                                                                <div className={`font-bold ${t.text}`}>
                                                                    Qty: {variant.quantity}
                                                                </div>
                                                            </div>
                                                            {variant.purchasePrice && (
                                                                <div className={`text-sm ${t.text} mb-1`}>
                                                                    üí∞ Purchase Price: ${parseFloat(variant.purchasePrice).toLocaleString()}
                                                                </div>
                                                            )}
                                                            {variant.purchaseDate && (
                                                                <div className={`text-xs ${t.textMuted} mb-1`}>
                                                                    üìÖ Acquired: {new Date(variant.purchaseDate).toLocaleDateString()}
                                                                </div>
                                                            )}
                                                            {variant.notes && (
                                                                <div className={`text-sm ${t.text} italic mt-2`}>
                                                                    "{variant.notes}"
                                                                </div>
                                                            )}
                                                        </div>
                                                        <button
                                                            onClick={() => deleteVariant(detailCard.id, variant.id)}
                                                            className={`${t.buttonDanger} text-white px-3 py-1 rounded text-xs`}
                                                            disabled={(detailCard.variants || []).length <= 1}
                                                        >
                                                            üóëÔ∏è
                                                        </button>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>

                                        <div className={`mt-4 ${t.card} border ${t.cardBorder} rounded-lg p-3`}>
                                            <div className="grid grid-cols-2 gap-4 text-center">
                                                <div>
                                                    <div className={`text-xs ${t.textMuted}`}>Total Cards</div>
                                                    <div className={`text-2xl font-bold ${t.text}`}>
                                                        {(detailCard.variants || []).reduce((sum, v) => sum + (v.quantity || 0), 0)}
                                                    </div>
                                                </div>
                                                <div>
                                                    <div className={`text-xs ${t.textMuted}`}>Total Investment</div>
                                                    <div className={`text-2xl font-bold text-green-400`}>
                                                        ${(detailCard.variants || []).reduce((sum, v) => {
                                                            const price = parseFloat(v.purchasePrice) || 0;
                                                            return sum + (price * (v.quantity || 0));
                                                        }, 0).toLocaleString()}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Price History */}
                                    <div className={`${t.card} rounded-lg p-4`}>
                                        <div className="flex items-center justify-between mb-4">
                                            <h3 className={`text-lg font-bold ${t.text} flex items-center gap-2`}>
                                                üí∞ Price History
                                                {detailCard.priceHistory && detailCard.priceHistory.length > 0 && (
                                                    <span className="text-sm bg-green-600 text-white px-2 py-1 rounded-full">
                                                        {detailCard.priceHistory.length} record{detailCard.priceHistory.length > 1 ? 's' : ''}
                                                    </span>
                                                )}
                                            </h3>
                                            <button
                                                onClick={() => { setShowCardDetailModal(false); openAddPrice(detailCard); }}
                                                className={`${t.buttonPrimary} text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors`}
                                            >
                                                ‚ûï Add Price
                                            </button>
                                        </div>

                                        {detailCard.priceHistory && detailCard.priceHistory.length > 0 ? (
                                            <div className="space-y-3">
                                                {[...detailCard.priceHistory].reverse().map((priceEntry) => (
                                                    <div key={priceEntry.id} className={`${t.card} border ${t.cardBorder} rounded-lg p-4`}>
                                                        <div className="flex items-start justify-between gap-4">
                                                            <div className="flex-1">
                                                                <div className="flex items-center gap-3 mb-2">
                                                                    <div className="text-2xl font-bold text-green-400">
                                                                        ${priceEntry.price.toLocaleString()}
                                                                    </div>
                                                                    {priceEntry.gradeCompany && priceEntry.gradeCompany !== 'Raw' && (
                                                                        <div className="bg-blue-600 text-white px-3 py-1 rounded-full text-sm font-medium">
                                                                            {priceEntry.gradeCompany} {priceEntry.gradeValue}
                                                                        </div>
                                                                    )}
                                                                    {(!priceEntry.gradeCompany || priceEntry.gradeCompany === 'Raw') && (
                                                                        <div className="bg-gray-600 text-white px-3 py-1 rounded-full text-sm">
                                                                            Raw/Ungraded
                                                                        </div>
                                                                    )}
                                                                </div>
                                                                <div className={`text-sm ${t.textMuted} mb-1`}>
                                                                    üìÖ {priceEntry.dateFormatted}
                                                                </div>
                                                                {priceEntry.notes && (
                                                                    <div className={`text-sm ${t.text} italic mt-2`}>
                                                                        {priceEntry.notes}
                                                                    </div>
                                                                )}
                                                            </div>
                                                            <button
                                                                onClick={() => { if(confirm('Delete this price record?')) deletePriceRecord(detailCard.id, priceEntry.id); }}
                                                                className={`${t.buttonDanger} text-white px-3 py-1 rounded text-xs`}
                                                            >
                                                                üóëÔ∏è
                                                            </button>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        ) : (
                                            <div className={`text-center py-8 ${t.textMuted}`}>
                                                <div className="text-4xl mb-2">üìä</div>
                                                <div>No price history recorded yet</div>
                                                <div className="text-sm mt-2">Click "Add Price" to start tracking market values</div>
                                            </div>
                                        )}

                                        {detailCard.lastPriceCheck && (
                                            <div className={`mt-4 text-xs ${t.textMuted} text-center`}>
                                                Last price check: {new Date(detailCard.lastPriceCheck).toLocaleString()}
                                            </div>
                                        )}
                                    </div>

                                    {/* Quick Actions */}
                                    <div className="grid grid-cols-2 md:grid-cols-3 gap-3">
                                        <button
                                            onClick={() => { setShowCardDetailModal(false); openAddVariant(detailCard); }}
                                            className={`${t.buttonSuccess} text-white px-4 py-3 rounded-lg font-medium transition-colors`}
                                        >
                                            ‚ûï Add Copy
                                        </button>
                                        <button
                                            onClick={() => { setShowCardDetailModal(false); openAddPrice(detailCard); }}
                                            className={`${t.buttonPrimary} text-white px-4 py-3 rounded-lg font-medium transition-colors`}
                                        >
                                            üìù Record Price
                                        </button>
                                        <button
                                            onClick={() => { setShowCardDetailModal(false); findAndSaveImage(detailCard); }}
                                            className={`${t.buttonPurple} text-white px-4 py-3 rounded-lg font-medium transition-colors`}
                                        >
                                            üñºÔ∏è {detailCard.imageUrl ? 'Change' : 'Add'} Image
                                        </button>
                                        <button
                                            onClick={() => { setShowCardDetailModal(false); searchCardImage(detailCard); }}
                                            className={`${t.buttonPrimary} text-white px-4 py-3 rounded-lg font-medium transition-colors`}
                                        >
                                            üîç Search Images
                                        </button>
                                        <button
                                            onClick={() => { setShowCardDetailModal(false); checkPrice(detailCard); }}
                                            className={`${t.buttonSuccess} text-white px-4 py-3 rounded-lg font-medium transition-colors`}
                                        >
                                            üí∞ Check 130point
                                        </button>
                                    </div>

                                    {/* Move to Collection */}
                                    {Object.keys(collections).length > 1 && (
                                        <div className={`${t.card} border ${t.cardBorder} rounded-lg p-4`}>
                                            <h4 className={`text-sm font-semibold ${t.text} mb-2`}>üì¶ Move to Collection</h4>
                                            <div className="flex gap-2 flex-wrap">
                                                {Object.entries(collections)
                                                    .filter(([id]) => id !== currentCollection)
                                                    .map(([id, collection]) => (
                                                        <button
                                                            key={id}
                                                            onClick={() => {
                                                                if (confirm(`Move "${detailCard.description}" to "${collection.name}"?`)) {
                                                                    moveCardToCollection(detailCard, id);
                                                                    setShowCardDetailModal(false);
                                                                }
                                                            }}
                                                            className={`px-3 py-2 ${t.button} text-white text-sm rounded-lg transition-colors`}
                                                        >
                                                            ‚Üí {collection.name}
                                                        </button>
                                                    ))
                                                }
                                            </div>
                                        </div>
                                    )}

                                    <button
                                        onClick={() => setShowCardDetailModal(false)}
                                        className={`w-full ${t.button} text-white px-6 py-3 rounded-lg transition-colors font-medium`}
                                    >
                                        Close
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Add Price Modal */}
                    {showAddPriceModal && priceCard && (
                        <div className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4 overflow-y-auto">
                            <div className={`${t.card} rounded-lg shadow-2xl max-w-2xl w-full my-8 max-h-[90vh] overflow-hidden flex flex-col`}>
                                <div className={`${t.card} border-b ${t.cardBorder} p-4 md:p-6 flex justify-between items-center flex-shrink-0`}>
                                    <h2 className={`text-xl md:text-2xl font-bold ${t.text}`}>Record Market Price</h2>
                                    <button
                                        onClick={() => setShowAddPriceModal(false)}
                                        className={`${t.textMuted} hover:${t.text} text-3xl leading-none min-h-[44px] min-w-[44px] flex items-center justify-center`}
                                    >
                                        √ó
                                    </button>
                                </div>
                                
                                <div className="p-4 md:p-6 space-y-4 overflow-y-auto flex-1">
                                    {/* Card Info */}
                                    <div className={`${t.card} border ${t.cardBorder} rounded-lg p-4`}>
                                        <div className={`font-semibold ${t.text} mb-1`}>{priceCard.description}</div>
                                        <div className={`text-sm ${t.textMuted}`}>
                                            {priceCard.year} ‚Ä¢ {priceCard.brand} 
                                            {priceCard.cardNumber && ` ‚Ä¢ #${priceCard.cardNumber}`}
                                        </div>
                                    </div>

                                    {/* Price Input */}
                                    <div>
                                        <label className={`block text-sm font-medium ${t.text} mb-2`}>Market Price *</label>
                                        <div className="relative">
                                            <span className="absolute left-3 top-3 text-gray-400">$</span>
                                            <input
                                                type="text"
                                                value={newPrice}
                                                onChange={(e) => setNewPrice(e.target.value)}
                                                placeholder="0.00"
                                                className={`w-full pl-8 pr-4 py-3 ${t.input} rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600`}
                                            />
                                        </div>
                                        <div className={`text-xs ${t.textMuted} mt-1`}>
                                            Enter the current market price you found (e.g., from 130point, eBay, etc.)
                                        </div>
                                    </div>

                                    {/* Grade Selection */}
                                    <div>
                                        <label className={`block text-sm font-medium ${t.text} mb-2`}>Grade Information</label>
                                        <div className="grid grid-cols-2 gap-4">
                                            <div>
                                                <label className={`block text-xs ${t.textMuted} mb-2`}>Grading Company</label>
                                                <select
                                                    value={priceGradeCompany}
                                                    onChange={(e) => setPriceGradeCompany(e.target.value)}
                                                    className={`w-full px-4 py-3 ${t.input} rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600`}
                                                >
                                                    <option value="">Raw/Ungraded</option>
                                                    <option value="PSA">PSA</option>
                                                    <option value="BGS">BGS (Beckett)</option>
                                                    <option value="SGC">SGC</option>
                                                    <option value="CGC">CGC</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label className={`block text-xs ${t.textMuted} mb-2`}>Grade</label>
                                                <select
                                                    value={priceGradeValue}
                                                    onChange={(e) => setPriceGradeValue(e.target.value)}
                                                    disabled={!priceGradeCompany}
                                                    className={`w-full px-4 py-3 ${t.input} rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600 disabled:opacity-50`}
                                                >
                                                    <option value="">Select Grade</option>
                                                    <option value="10">10 - Gem Mint</option>
                                                    <option value="9.5">9.5 - Mint+</option>
                                                    <option value="9">9 - Mint</option>
                                                    <option value="8.5">8.5 - NM-Mint+</option>
                                                    <option value="8">8 - NM-Mint</option>
                                                    <option value="7.5">7.5 - NM+</option>
                                                    <option value="7">7 - Near Mint</option>
                                                    <option value="Authentic">Authentic (Altered/No Grade)</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Notes */}
                                    <div>
                                        <label className={`block text-sm font-medium ${t.text} mb-2`}>Notes (Optional)</label>
                                        <textarea
                                            value={priceNotes}
                                            onChange={(e) => setPriceNotes(e.target.value)}
                                            placeholder="e.g., Found on eBay, 130point average, recent auction..."
                                            rows="3"
                                            className={`w-full px-4 py-3 ${t.input} rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600`}
                                        />
                                    </div>

                                    {/* Timestamp Info */}
                                    <div className={`${t.card} border ${t.cardBorder} rounded-lg p-3`}>
                                        <div className={`text-xs ${t.textMuted}`}>
                                            üìÖ This price will be recorded with today's date: {new Date().toLocaleDateString()}
                                        </div>
                                    </div>

                                    {/* Action Buttons */}
                                    <div className="flex gap-3 pt-4">
                                        <button
                                            onClick={addPriceRecord}
                                            disabled={!newPrice}
                                            className={`flex-1 ${t.buttonSuccess} text-white px-6 py-3 rounded-lg transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed`}
                                        >
                                            üíæ Save Price Record
                                        </button>
                                        <button
                                            onClick={() => setShowAddPriceModal(false)}
                                            className={`${t.button} text-white px-6 py-3 rounded-lg transition-colors font-medium`}
                                        >
                                            Cancel
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Add Variant Modal */}
                    {showAddVariantModal && variantCard && (
                        <div className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4 overflow-y-auto">
                            <div className={`${t.card} rounded-lg shadow-2xl max-w-2xl w-full my-8 max-h-[90vh] overflow-hidden flex flex-col`}>
                                <div className={`${t.card} border-b ${t.cardBorder} p-4 md:p-6 flex justify-between items-center flex-shrink-0`}>
                                    <h2 className={`text-xl md:text-2xl font-bold ${t.text}`}>Add Card Variant</h2>
                                    <button
                                        onClick={() => setShowAddVariantModal(false)}
                                        className={`${t.textMuted} hover:${t.text} text-3xl leading-none min-h-[44px] min-w-[44px] flex items-center justify-center`}
                                    >
                                        √ó
                                    </button>
                                </div>
                                
                                <div className="p-4 md:p-6 space-y-4 overflow-y-auto flex-1">
                                    <div className={`${t.card} border ${t.cardBorder} rounded-lg p-4`}>
                                        <div className={`font-semibold ${t.text} mb-1`}>{variantCard.description}</div>
                                        <div className={`text-sm ${t.textMuted}`}>
                                            Adding another copy in different condition/grade
                                        </div>
                                    </div>

                                    <div>
                                        <label className={`block text-sm font-medium ${t.text} mb-2`}>Grade/Condition *</label>
                                        <div className="grid grid-cols-2 gap-4">
                                            <div>
                                                <label className={`block text-xs ${t.textMuted} mb-2`}>Company</label>
                                                <select
                                                    value={variantGradeCompany}
                                                    onChange={(e) => setVariantGradeCompany(e.target.value)}
                                                    className={`w-full px-4 py-3 ${t.input} rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600`}
                                                >
                                                    <option value="">Raw/Ungraded</option>
                                                    <option value="PSA">PSA</option>
                                                    <option value="BGS">BGS (Beckett)</option>
                                                    <option value="SGC">SGC</option>
                                                    <option value="CGC">CGC</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label className={`block text-xs ${t.textMuted} mb-2`}>Grade</label>
                                                <select
                                                    value={variantGradeValue}
                                                    onChange={(e) => setVariantGradeValue(e.target.value)}
                                                    disabled={!variantGradeCompany}
                                                    className={`w-full px-4 py-3 ${t.input} rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600 disabled:opacity-50`}
                                                >
                                                    <option value="">Select Grade</option>
                                                    <option value="10">10 - Gem Mint</option>
                                                    <option value="9.5">9.5 - Mint+</option>
                                                    <option value="9">9 - Mint</option>
                                                    <option value="8.5">8.5 - NM-Mint+</option>
                                                    <option value="8">8 - NM-Mint</option>
                                                    <option value="7.5">7.5 - NM+</option>
                                                    <option value="7">7 - Near Mint</option>
                                                    <option value="Authentic">Authentic</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className={`block text-sm font-medium ${t.text} mb-2`}>Quantity *</label>
                                            <input
                                                type="number"
                                                min="1"
                                                value={variantQuantity}
                                                onChange={(e) => setVariantQuantity(e.target.value)}
                                                className={`w-full px-4 py-3 ${t.input} rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600`}
                                            />
                                        </div>
                                        <div>
                                            <label className={`block text-sm font-medium ${t.text} mb-2`}>Purchase Price (Optional)</label>
                                            <div className="relative">
                                                <span className="absolute left-3 top-3 text-gray-400">$</span>
                                                <input
                                                    type="text"
                                                    value={variantPurchasePrice}
                                                    onChange={(e) => setVariantPurchasePrice(e.target.value)}
                                                    placeholder="0.00"
                                                    className={`w-full pl-8 pr-4 py-3 ${t.input} rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600`}
                                                />
                                            </div>
                                        </div>
                                    </div>

                                    <div>
                                        <label className={`block text-sm font-medium ${t.text} mb-2`}>Notes (Optional)</label>
                                        <textarea
                                            value={variantNotes}
                                            onChange={(e) => setVariantNotes(e.target.value)}
                                            placeholder="Purchase location, condition notes, etc."
                                            rows="3"
                                            className={`w-full px-4 py-3 ${t.input} rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600`}
                                        />
                                    </div>

                                    <div className="flex gap-3 pt-4">
                                        <button
                                            onClick={addVariant}
                                            className={`flex-1 ${t.buttonSuccess} text-white px-6 py-3 rounded-lg transition-colors font-medium`}
                                        >
                                            ‚úÖ Add Variant
                                        </button>
                                        <button
                                            onClick={() => setShowAddVariantModal(false)}
                                            className={`${t.button} text-white px-6 py-3 rounded-lg transition-colors font-medium`}
                                        >
                                            Cancel
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Collection Manager Modal */}
                    {showCollectionManager && (
                        <div className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4">
                            <div className={`${t.card} rounded-lg shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col`}>
                                <div className={`${t.card} border-b ${t.cardBorder} p-4 md:p-6 flex justify-between items-center flex-shrink-0`}>
                                    <h2 className={`text-xl md:text-2xl font-bold ${t.text}`}>üìÅ Manage Collections</h2>
                                    <button
                                        onClick={() => setShowCollectionManager(false)}
                                        className={`${t.textMuted} hover:${t.text} text-3xl leading-none`}
                                    >
                                        √ó
                                    </button>
                                </div>
                                
                                <div className="p-4 md:p-6 space-y-4 overflow-y-auto flex-1">
                                    {/* Create New Collection */}
                                    <div className={`${t.card} border ${t.cardBorder} rounded-lg p-4`}>
                                        <h3 className={`text-lg font-semibold ${t.text} mb-3`}>Create New Collection</h3>
                                        <div className="flex gap-2">
                                            <input
                                                type="text"
                                                value={newCollectionName}
                                                onChange={(e) => setNewCollectionName(e.target.value)}
                                                placeholder="Enter collection name..."
                                                className={`flex-1 px-4 py-2 ${t.input} rounded-lg`}
                                                onKeyPress={(e) => e.key === 'Enter' && createCollection()}
                                            />
                                            <button
                                                onClick={createCollection}
                                                className={`px-4 py-2 ${t.buttonSuccess} text-white rounded-lg`}
                                            >
                                                ‚ûï Create
                                            </button>
                                        </div>
                                    </div>

                                    {/* Existing Collections */}
                                    <div>
                                        <h3 className={`text-lg font-semibold ${t.text} mb-3`}>Your Collections</h3>
                                        <div className="space-y-2">
                                            {Object.entries(collections).map(([id, collection]) => (
                                                <div key={id} className={`${t.card} border ${t.cardBorder} rounded-lg p-4 flex items-center justify-between`}>
                                                    <div className="flex-1">
                                                        <div className="flex items-center gap-2">
                                                            <span className="text-xl">üìÅ</span>
                                                            <span className={`font-semibold ${t.text}`}>{collection.name}</span>
                                                            {currentCollection === id && (
                                                                <span className="text-xs bg-blue-600 text-white px-2 py-0.5 rounded-full">
                                                                    Current
                                                                </span>
                                                            )}
                                                        </div>
                                                        <div className={`text-sm ${t.textMuted} mt-1`}>
                                                            {collection.cards?.length || 0} cards
                                                        </div>
                                                    </div>
                                                    <div className="flex gap-2">
                                                        {currentCollection !== id && (
                                                            <button
                                                                onClick={() => switchCollection(id)}
                                                                className={`px-3 py-1 ${t.buttonPrimary} text-white text-xs rounded`}
                                                            >
                                                                Switch
                                                            </button>
                                                        )}
                                                        {id !== 'main' && (
                                                            <button
                                                                onClick={() => deleteCollection(id)}
                                                                className={`px-3 py-1 ${t.buttonDanger} text-white text-xs rounded`}
                                                            >
                                                                üóëÔ∏è
                                                            </button>
                                                        )}
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>

                                    {/* Tips */}
                                    <div className={`${t.card} border ${t.cardBorder} rounded-lg p-4`}>
                                        <h4 className={`font-semibold ${t.text} mb-2`}>üí° Tips</h4>
                                        <ul className={`text-sm ${t.textMuted} space-y-1`}>
                                            <li>‚Ä¢ Use collections to organize cards by purpose</li>
                                            <li>‚Ä¢ Move cards between collections from card details</li>
                                            <li>‚Ä¢ Each collection is saved separately</li>
                                            <li>‚Ä¢ Export collections individually for backup</li>
                                        </ul>
                                    </div>
                                </div>

                                <div className={`${t.card} border-t ${t.cardBorder} p-4 flex justify-end`}>
                                    <button
                                        onClick={() => setShowCollectionManager(false)}
                                        className={`px-6 py-2 ${t.button} text-white rounded-lg`}
                                    >
                                        Done
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Footer */}
                    <div className="max-w-7xl mx-auto px-4 py-6 mt-6 border-t border-gray-700">
                        <p className="text-center text-gray-400 text-sm">
                            My MJ Collection Tracker ‚Ä¢ {stats.uniqueCards} unique cards ‚Ä¢ {stats.totalCards} total ‚Ä¢ ${stats.currentValue} current value
                        </p>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
